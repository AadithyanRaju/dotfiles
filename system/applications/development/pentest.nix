{ config, lib, pkgs, ... }:
with lib;
let 
  cfg = config.features.pentest;
in
{
  options.features.pentest = {
    enable = mkOption {
      type = types.bool;
      default = false;
      description = "Install Penetration Testing tools.";
    };
    additionalTools = mkOption {
      type = types.listOf types.package;
      default = [ ];
      description = "List of additional pentesting tools to install.";
    };
  };
  config = mkMerge [
    (mkIf cfg.enable {
      environment.systemPackages = with pkgs; [
        binwalk
        exif
        exiftool
        hashcat
        nmap
        pdfcrack
        wireshark-qt
      ];
    })
    (mkIf (cfg.enable && (cfg.additionalTools != [])) {
      environment.systemPackages = with pkgs; cfg.additionalTools;
    })
  ];
}